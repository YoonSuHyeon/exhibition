# 전시

## 구현 범위에 대한 설명
- ### [구현 1] 카테고리별 최저가격 브랜드와 상품가격, 총액 조회 API
    - 예시를 확인 해보니, 가격이 같은 값인 경우는 브랜드 이름 내림차순 정렬로 표기
    - 아래 반환값 Key를 맞춤
    - | Method | URL                                 | Request |
      |--------|-------------------------------------|---------|
      | GET    | `api/v1/products/min-category-info` | X       |
    - 반환값
      ```json
      {
      "총액": "34,100",
      "상품": [
          {
              "카테고리": "상의",
              "브랜드": "C",
              "가격": "10,000"
          },
          {
              "카테고리": "아우터",
              "브랜드": "E",
              "가격": "5,000"
          },
          {
              "카테고리": "바지",
              "브랜드": "D",
              "가격": "3,000"
          },
          {
              "카테고리": "스니커즈",
              "브랜드": "G",
              "가격": "9,000"
          },
          {
              "카테고리": "가방",
              "브랜드": "A",
              "가격": "2,000"
          },
          {
              "카테고리": "모자",
              "브랜드": "D",
              "가격": "1,500"
          },
          {
              "카테고리": "양말",
              "브랜드": "I",
              "가격": "1,700"
          },
          {
              "카테고리": "액세서리",
              "브랜드": "F",
              "가격": "1,900"
          }
        ]
      }
      ```

- ### [구현 2] 단일 브랜드로 모든 카테고리 상품 구매시, 최저가격에 판매하는 브랜드와 카테고리의 상품가격, 총액 조회 API
    - | Method | URL                          | Request |
      |--------|------------------------------|---------|
      | GET    | `api/v1/products/brand-info` | X       |
    - 반환값
      ```json
      {
      "최저가": {
          "브랜드": "D",
          "카테고리": [
              {
                  "카테고리": "상의",
                  "가격": "10,100"
              },
              {
                  "카테고리": "아우터",
                  "가격": "5,100"
              },
              {
                  "카테고리": "바지",
                  "가격": "3,000"
              },
              {
                  "카테고리": "스니커즈",
                  "가격": "9,500"
              },
              {
                  "카테고리": "가방",
                  "가격": "2,500"
              },
              {
                  "카테고리": "모자",
                  "가격": "1,500"
              },
              {
                  "카테고리": "양말",
                  "가격": "2,400"
              },
              {
                  "카테고리": "액세서리",
                  "가격": "2,000"
              }
          ],
          "총액": "36,100"
         }
      }
      ```

- ### [구현 3] 카테고리 이름으로 최저, 최고 가격 브랜드와 상품 가격 조회 API
    - 최저가 혹은 최고가가 같은 금액으로 다수일 경우, 다수 상품을 모두 반환
    - | Method | URL                                                  | Request           |
      |--------|------------------------------------------------------|-------------------|
      | GET    | `/api/v1/products/min-max-category-info?category=상의` | category : String |
    - 반환값
      ```json
      {
        "카테고리": "상의",
        "최저가": [
          {
            "브랜드": "C",
            "가격": "10,000"
          }
        ],
        "최고가": [
          {
            "브랜드": "I",
            "가격": "11,400"
          }
        ]
      }
      ```

- ### [구현 4] 브랜드 및 상품 추가/업데이트/삭제 API
  - 전체 브랜드 조회, 전체 상품 조회는 어드민 기능에서 필수로 필요하다고 생각하여 추가함
  - 브랜드는 상품을 전부 삭제한 경우 삭제 가능하도록 구현 (운영하면서 휴먼에러로 브랜드를 삭제한 경우 모든 상품이 삭제 될 수 있기 때문)
  - Body와 Response는 제시된 클래스 확인 
  - | Method | URL                     | Body                    | Response           |
    |--------|-------------------------|-------------------------|--------------------|
    | GET    | `api/v1/admin/brands`   | X                       | BrandResponseDto   |
    | POST   | `api/v1/admin/brands`   | BrandInsertRequestDto   | X                  |
    | PUT    | `api/v1/admin/brands`   | BrandUpdateRequestDto   | X                  |
    | DELETE | `api/v1/admin/brands`   | BrandDeleteRequestDto   | X                  |
    | GET    | `api/v1/admin/products` | X                       | ProductResponseDto |
    | POST   | `api/v1/admin/products` | ProductInsertRequestDto | X                  |
    | PUT    | `api/v1/admin/products` | ProductUpdateRequestDto | X                  |
    | DELETE | `api/v1/admin/products` | ProductDeleteRequestDto | X                  |


## 가산점
- Unit test 및 Integration test 작성

## 코드 빌드, 테스트, 실행 방법

- 코드 빌드
    - Java 17 버전 다운로드 -> 환경변수 설정 후 실행 -> (Permission denied) 인경우 sudo 사용
      ``` 
      ./gradlew build
      ``` 
- 테스트
    - 작성된 테스트 코드 실행
      ``` 
      ./gradlew test
      ```
- 실행 방법
    - 코드 빌드 이후
      ``` 
      java -jar build/libs/exhibition-0.0.1-SNAPSHOT.jar
      ```

## 기타 추가 정보
전시 관련 서비스에서는 생성,변경,삭제보다는 조회가 많다고 생각 했습니다. 그래서 임시로 만든 CustomCacheUtils를 redis대신 사용했습니다. <br>
따라서, 조회는 캐시를 사용하고, 상품이 변경되는 경우 ProductEventHandler에서 캐시에 데이터를 넣어주는 방향으로 생각했습니다. <br>
ProductEventHandler는 상품이 변경되는 경우 @EventListener를 사용해 한곳에서 처리하도록 했습니다. <br>
아래 예시는 잘못된 카테고리로 [구현 3]을 호출하는 경우 입니다.아래처럼 문제가된 value 그리고 자세한 message를 반환 하도록 했습니다. 
 ``` json
{
    "value": "무신사",
    "message": "존재 하지 않는 카테고리 입니다."
}
```
테스트는 TestCommandLineRunner를 통해서 서버가 가동되는 경우 예시 데이터가 들어가게 됩니다. <br>
따라서 위에 제시된 API 정보를 활용해서 상품을 수정하고, 브랜드를 수정하는 것을 테스트 해보시면 됩니다. <br>




